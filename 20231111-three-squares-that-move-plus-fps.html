<html>
<body style="background-color: black">
    <canvas id="canvas" style="outline: white solid 1px;"></canvas>

    <script type="text/javascript">

        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        canvas.width = 400;
        canvas.height = 400;

        const state = {
            top: 30,
            bottom: canvas.height - 20,

            xA: 10,
            yA: 30,
            
            xB: 10,
            yB: 60,

            xC: 10,
            yC: 90,

            frameCounterIndex: 0,
            frameCounters: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            frameCount: 0
        };

        const countFrame = (date) => {
            const milliseconds = date.getMilliseconds();
            const counterIndex = Math.floor(milliseconds / 100);

            // Same index
            if (counterIndex === state.frameCounterIndex) {
                state.frameCounters[counterIndex] = state.frameCounters[counterIndex] + 1;
                return;
            }

            // Wrapped around index
            if (counterIndex < state.frameCounterIndex) {
                // Set any missed ones at the start to zero
                for (let index = 0; index < counterIndex; index++) {
                    state.frameCounters[index] = 0;
                }

                // Set any missed ones from end to zero
                for (let index = state.frameCounterIndex + 1; index < state.frameCounters.length; index++) {
                    state.frameCounters[index] = 0;
                }
            }
            // Otherwise we've moved on
            else {
                // Set any missed ones to zero
                for (let index = state.frameCounterIndex + 1; index < counterIndex; index++) {
                    state.frameCounters[index] = 0;
                }
            }

            state.frameCounters[counterIndex] = 1;
            state.frameCounterIndex = counterIndex;
        };

        const updateFpsCount = () => {
            state.frameCount = state.frameCounters.reduce((accumulator, currentValue) => accumulator + currentValue, 0);
        }

        const render = () => {
            // Move A
            state.yA = (state.yA > state.bottom) ? state.top : (state.yA + 2);

            // Move B
            state.xB = (state.xB + 1) % canvas.width;
            state.yB = (state.yB + 2) % canvas.height;

            // Move C
            state.xC = (state.xC + 1) % canvas.width;
            state.yC = (state.yC + 2) % canvas.height;

            // Clear
            ctx.strokeStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw the time & FPS
            let date = new Date();
            countFrame(date);
            ctx.strokeStyle = "white";
            ctx.strokeText(date.toISOString(), 10, 10);
            ctx.strokeText(`FPS: ${state.frameCount}`, canvas.width - 50, 10);

            // Draw A
            ctx.strokeStyle = "red";
            ctx.strokeRect(state.xA, state.yA, 10, 10);

            // Draw B
            ctx.strokeStyle = "green";
            ctx.strokeRect(state.xB, state.yB, 10, 10);

            // Draw C
            ctx.strokeStyle = "blue";
            ctx.strokeRect(state.xC, state.yC, 10, 10);
        };

        // Render ~40FPS
        window.setInterval(render, 25);

        // Update FPS Count outside of render to reduce flickering
        window.setInterval(updateFpsCount, 1000);

    </script>
</body>
</html>